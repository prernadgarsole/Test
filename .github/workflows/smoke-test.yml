
name: Asana Integration Workflow

on:
  push:
    branches:
      - main
  issue_comment:
    types:
      - created
  workflow_run:
    workflows: ["Asana Integration"]
    types:
      - completed
      - comment_added
      - modified

jobs:
  asana:
    runs-on: windows-latest
    steps:
      - name: Install Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '14'

      - name: Create/Update Asana task
        run: |
          npm install --save axios nodemailer
          node -e "
            const axios = require('axios');
            const nodemailer = require('nodemailer');

            const token = '1/1200663996881544:3dfe48082ee0407050945c1cf1daaff7';
              const projectId = '1201711203404129';
              const workspaceId = '10415102240585';

            const validateToken = async () => {
              try {
                const response = await axios.get('https://app.asana.com/api/1.0/users/me', {
                  headers: {
                    'Authorization': 'Bearer ' + token,
                  },
                });

                if (response.status === 200) {
                  console.log('Token validation successful');
                  validateProjectAndWorkspace();
                } else {
                  console.error('Token validation failed');
                }
              } catch (error) {
                console.error('Error validating token:', error.response.data.errors);
              }
            };

            const validateProjectAndWorkspace = async () => {
              try {
                const response = await axios.get(`https://app.asana.com/api/1.0/projects/${projectId}`, {
                  headers: {
                    'Authorization': 'Bearer ' + token,
                  },
                });

                if (response.status === 200 && response.data.data.workspace.id === workspaceId) {
                  console.log('Project and workspace validation successful');
                  // Proceed with your integration logic here
                } else {
                  console.error('Project or workspace validation failed');
                }
              } catch (error) {
                console.error('Error validating project or workspace:', error.response.data.errors);
              }
            };

            validateToken();
          "

